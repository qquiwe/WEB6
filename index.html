<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Варіант 16 — Створення Toast-ів</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .toast-preview {
      position: relative;
      display: inline-block;
      min-height: 60px;
      padding: 12px 16px;
      margin: 8px;
      background: #333;
      color: white;
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      opacity: 0.95;
    }
    .toast-header { font-weight: bold; margin-bottom: 4px; }
    .close-toast { 
      position: absolute; top: 4px; right: 8px; 
      background:none; border:none; color:white; font-size:18px; cursor:pointer;
    }
  </style>
</head>
<body>
<div class="page">
  <div class="block block1">
    <h2>Створення Toast-повідомлень</h2>
    <div class="badge x"><h4>Варіант 16</h4></div>
  </div>

  <!-- Центральний блок — форма створення тостів -->
  <div class="block block3" id="creator">
    <h3>Додати новий Toast</h3>
    <div style="margin-bottom:16px;">
      <label>Заголовок: <input type="text" id="title" style="width:100%;padding:6px;"></label><br><br>
      <label>Текст: <textarea id="body" style="width:100%;height:80px;padding:6px;"></textarea></label><br><br>
      <label>Кількість тостів: <input type="number" id="count" min="1" max="20" value="1"></label><br><br>
      <button onclick="addToasts()">Додати тости</button>
    </div>

    <h3>Попередній перегляд</h3>
    <div id="preview"></div>

    <button onclick="saveAll()" style="margin-top:20px;padding:10px 20px;font-size:16px;">
      Зберегти всі тости на сервер
    </button>
    <p id="status"></p>
  </div>

  <div class="block block4">
    <div class="badge y"><h4>Toast Creator</h4></div>
    <h2>Керування тостами</h2>
  </div>

  <div class="gutter" aria-hidden="true"></div>

  <div class="block block2">
    <nav>
      <ul class="menu">
        <li><a href="index.html">Створення</a></li>
        <li><a href="page2.html">Перегляд</a></li>
      </ul>
    </nav>
  </div>

  <div class="block block5">
    <p>Варіант 16 — набір об'єктів «Toasts»</p>
  </div>
</div>

<script>
let toasts = [];

// Додавання тостів у локальний масив та прев'ю
function addToasts() {
  const title = document.getElementById('title').value.trim() || 'Повідомлення';
  const body  = document.getElementById('body').value.trim() || 'Текст тосту';
  const count = parseInt(document.getElementById('count').value) || 1;

  for(let i = 0; i < count; i++) {
    const toast = {
      id: Date.now() + i,
      title: title + (count > 1 ? ` ${i+1}` : ''),
      body: body,
      timestamp: new Date().toISOString()
    };
    toasts.push(toast);
  }
  renderPreview();
}

function renderPreview() {
  const preview = document.getElementById('preview');
  preview.innerHTML = '';
  toasts.forEach(t => {
    const div = document.createElement('div');
    div.className = 'toast-preview';
    div.innerHTML = `
      <button class="close-toast" onclick="removeToast(${t.id})">&times;</button>
      <div class="toast-header">${t.title}</div>
      <div>${t.body}</div>
      <small>${new Date(t.timestamp).toLocaleString()}</small>
    `;
    preview.appendChild(div);
  });
}

function removeToast(id) {
  toasts = toasts.filter(t => t.id !== id);
  renderPreview();
}

// Збереження на сервер
async function saveAll() {
  const status = document.getElementById('status');
  status.textContent = 'Збереження...';
  try {
    const res = await fetch('save_toasts.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(toasts)
    });
    const text = await res.text();
    if(res.ok) {
      status.style.color = 'green';
      status.textContent = 'Успішно збережено! (' + toasts.length + ' тостів)';
    } else {
      throw new Error(text);
    }
  } catch(e) {
    status.style.color = 'red';
    status.textContent = 'Помилка: ' + e.message;
  }
}
</script>
</body>
</html>